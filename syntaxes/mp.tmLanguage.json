{
	"$schema": "https://raw.githubusercontent.com/martinring/tmlanguage/master/tmlanguage.json",
	"scopeName": "source.mp",
	"injectTo": "L:comment.block",
	"name": "MP",
	"patterns": [
		{
			"include": "#comment"
		},
		{
			"include": "#mpstring"
		},
		{
			"match": "(\\s*<!--\\s*)(MPIF|MPELSEIF|MPELSE|MPLOOP|MPVAR|MPBLOCK|MPFUNCTION|MPLIB|MPINIT|MPBREAK|\\$INCLUDE)\\s*(:)?(.*)(\\s*-->)",
			"name": "source.mp",
			"captures": {
				"0": {"name": "comment.block.html"},
				"1": {"name": "punctuation.definition.tag.begin.html"},
				"2": {
					"name": "keyword.control.mp"
				},
				"3": {"name": "punctuation.separator.mp"},
				"4": {
					"name": "mp.mod-perl",
					"patterns": [
						{
							"include": "#mpstring"
						},
						{
							"include": "#mod-perl"
						}
					]
				},
				"5": {"name": "punctuation.definition.tag.end.mp"}
			}
		},
		{
			"match": "(\\s*<!--\\s*)(MPENDIF|MPENDLOOP|MPENDVAR|MPENDBLOCK)\\s*(:)?(.*)(\\s*-->)",
			"name": "source.mp",
			"captures": {
				"0": {"name": "comment.block.html"},
				"1": {"name": "punctuation.definition.tag.begin.mp"},
				"2": {
					"name": "keyword.control.mp"
				},
				"3": {"name": "punctuation.separator.mp"},
				"4": {
					"name": "mp.mod-perl",
					"patterns": [{
						"include": "#mod-perl"
					}]
				 },
				"5": {"name": "punctuation.definition.tag.end.mp"}
			}
		},
		{
			"include": "text.html.basic"
		},
		{
			"include": "text.html.derivative"
		}
	],
	"repository": {
		"mod-perl": {
			"patterns": [
				{"include":"#function"},
				{"include":"#variable"},
				{"include":"mod-perl#mpstring"},
				{"include":"#mpstring"}
			]
		},
        "comment": {
            "patterns": [{
                    "begin": "/\\*",
                    "end": "\\*/",
                    "name": "comment.block.mp"
            }]
		},
		"function": {
			"patterns": [
				{
					"match": "(\\w+)\\(",
					"captures": {
						"1": {"name":"entity.name.function.mp"}
					}
				}
			]
		},
		"constants": {
			"patterns": [
				{
					"match": "\\W+(\\d+)\\W+",
					"captures": {
						"1": {"name": "constant.numeric.mp"}
					}
				}
			]
		},
		"variable": {
			"patterns": [
				{
					"match": "(\\$\\{)(\\w+)(\\})",
					"captures":{
						"1": {"name": "punctuation.shiz"},
						"2": {"name": "storage.type.var.mp"},
						"3": {"name": "punctuation.shiz"}
					}
				},
				{
					"match": "\\W*(\\$\\w+)\\W*",
					"captures":{
						"1": {"name":"storage.type.var.mp"}
					}
				},
				{
					"match": "\\W*(\\w+)\\W*",
					"captures": {
						"1": {"name": "storage.type.var.mp"}
					}
				}
			]
		},
		"mpstring": {
			"patterns": [
				{
                    "begin": "'",
                    "end": "'",
                    "name": "string.quoted.single.html"
				},
				{
					"begin": "\"",
					"end": "\"",
					"name": "string.quoted.double.html"
				}
			]
		}
    }
}